<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Ultimate Social App</title>
<style>
body { font-family: Arial; padding:20px; }
#appSection { display:none; }
button { margin:5px; padding:8px 12px; }
</style>
</head>
<body>

<h2>ðŸ”¥ Ultimate Social App</h2>

<div id="authSection">
  <button id="googleBtn">Login with Google</button>
  <button id="guestBtn">Guest Login</button>
</div>

<div id="appSection">
  <p>Logged in as: <b id="userInfo"></b></p>
  <button id="logoutBtn">Logout</button>
</div>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const supabase = createClient(
  "https://dgehzagvyrxbnnvgsiff.supabase.co",
  "sb_publishable_0zcUZcMnYsVKrX0rhxA9Eg_6GwlyzKW"
);

const googleBtn = document.getElementById("googleBtn");
const guestBtn = document.getElementById("guestBtn");
const logoutBtn = document.getElementById("logoutBtn");

const authSection = document.getElementById("authSection");
const appSection = document.getElementById("appSection");
const userInfo = document.getElementById("userInfo");

/* ================= LOGIN ================= */

googleBtn.addEventListener("click", async () => {
  await supabase.auth.signInWithOAuth({
    provider: "google",
    options: { redirectTo: window.location.origin }
  });
});

guestBtn.addEventListener("click", async () => {
  await supabase.auth.signInAnonymously();
});

/* ================= LOGOUT ================= */

logoutBtn.addEventListener("click", async () => {
  await supabase.auth.signOut();
});

/* ================= AUTO UI UPDATE ================= */

async function checkUser() {
  const { data } = await supabase.auth.getSession();
  if (data.session) {
    authSection.style.display = "none";
    appSection.style.display = "block";
    userInfo.innerText = data.session.user.email || "Guest";
  } else {
    authSection.style.display = "block";
    appSection.style.display = "none";
  }
}

supabase.auth.onAuthStateChange(() => {
  checkUser();
});

checkUser();

</script>

</body>
</html>