<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Social Website</title>

<style>
body{
  font-family: Arial;
  padding:20px;
  background:#f2f2f2;
}

.post{
  background:white;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

button{
  margin:5px 0;
  padding:6px 10px;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>üåç Social Website</h2>

<div id="authSection">
  <button id="googleBtn">Login with Google</button>
  <button id="guestBtn">Continue as Guest</button>
</div>

<div id="appSection" style="display:none;">
  <p>Logged in as: <span id="userEmail"></span></p>
  <button id="logoutBtn">Logout</button>

  <br><br>

  <input id="postInput" placeholder="Write something...">
  <button id="postBtn">Post</button>

  <div id="feed"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>

document.addEventListener("DOMContentLoaded", function(){

  const supabase = window.supabase.createClient(
    "https://dgehzagvyrxbnnvgsiff.supabase.co",
    "sb_publishable_0zcUZcMnYsVKrX0rhxA9Eg_6GwlyzKW"
  );

  const authSection = document.getElementById("authSection");
  const appSection = document.getElementById("appSection");
  const userEmail = document.getElementById("userEmail");

  // üî• Listen for login state
  supabase.auth.onAuthStateChange((event, session) => {
    if(session){
      authSection.style.display="none";
      appSection.style.display="block";
      userEmail.innerText = session.user.email || "Guest";
      loadPosts();
    } else {
      authSection.style.display="block";
      appSection.style.display="none";
    }
  });

  // Google Login
  document.getElementById("googleBtn").addEventListener("click", async ()=>{
    await supabase.auth.signInWithOAuth({
      provider:"google"
    });
  });

  // Guest Login
  document.getElementById("guestBtn").addEventListener("click", async ()=>{
    const { error } = await supabase.auth.signInAnonymously();
    if(error){
      alert(error.message);
    }
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", async ()=>{
    await supabase.auth.signOut();
  });

  // Post
  document.getElementById("postBtn").addEventListener("click", async ()=>{
    const text=document.getElementById("postInput").value;

    if(text.trim()===""){
      alert("Write something first");
      return;
    }

    const { error } = await supabase
      .from("posts")
      .insert([{ content:text }]);

    if(error){
      alert(error.message);
    } else {
      document.getElementById("postInput").value="";
      loadPosts();
    }
  });

  async function loadPosts(){
    const { data, error } = await supabase
      .from("posts")
      .select("*")
      .order("id",{ascending:false});

    if(error){
      console.log(error);
      return;
    }

    const feed=document.getElementById("feed");
    feed.innerHTML="";

    data.forEach(p=>{
      const div=document.createElement("div");
      div.className="post";
      div.innerText=p.content;
      feed.appendChild(div);
    });
  }

});

</script>

</body>
</html>
